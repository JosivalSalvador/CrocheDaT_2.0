

> server@1.0.0 test
> npm run test:setup && dotenv -e .env.test -- vitest run

[1G[0K
> server@1.0.0 test:setup
> dotenv -e .env.test -- prisma migrate reset --force

[1G[0K[2mLoaded Prisma config from prisma.config.ts.
[22m
[2mPrisma schema loaded from prisma/schema.prisma.[22m
[2mDatasource "db": PostgreSQL database "ecommerce_test", schema "public" at "localhost:5433"[22m

Applying migration `20260112183756_init_pro_schema`
Applying migration `20260113163031_ajuste_categories`
Applying migration `20260113171037_create_users_table`
Applying migration `20260118152836_base_full`

[32mDatabase reset successful[39m

The following migration(s) have been applied:

migrations/
  ‚îî‚îÄ 20260112183756_[36m[1minit_pro_schema[22m[39m/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20260113163031_[36m[1majuste_categories[22m[39m/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20260113171037_[36m[1mcreate_users_table[22m[39m/
    ‚îî‚îÄ migration.sql
  ‚îî‚îÄ 20260118152836_[36m[1mbase_full[22m[39m/
    ‚îî‚îÄ migration.sql

[1G[0K‚†ô[1G[0K[?25l
[1m[46m RUN [49m[22m [36mv4.0.17 [39m[90m/home/marcosbala070/Documentos/crochedaT_2/server[39m

[?2026h
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.service.spec.ts[2m [queued][22m

[2m Test Files [22m[1m[32m0 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m0 passed[39m[22m[90m (0)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m204ms
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K
[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.service.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.service.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.service.spec.ts[2m 0/2[22m

[2m Test Files [22m[1m[32m0 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m0 passed[39m[22m[90m (2)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m608ms
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K
[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.service.spec.ts[2m 0/4[22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.service.spec.ts[2m 1/4[22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.service.spec.ts[2m 0/2[22m

[2m Test Files [22m[1m[32m0 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m1 passed[39m[22m[90m (10)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m909ms
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K [32m‚úì[39m src/resources/tokens/tests/refresh.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 279[2mms[22m[39m

[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.service.spec.ts[2m 3/4[22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.service.spec.ts[2m 0/2[22m

[2m Test Files [22m[1m[32m1 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m7 passed[39m[22m[90m (10)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m1.01s
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K [32m‚úì[39m src/resources/auth/tests/sessions.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 341[2mms[22m[39m

[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m [queued][22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.service.spec.ts[2m 1/2[22m

[2m Test Files [22m[1m[32m2 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m9 passed[39m[22m[90m (10)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m1.21s
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K{"level":30,"time":1772304803520,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-1","req":{"method":"POST","url":"/api/v1/users","host":"127.0.0.1:40167","remoteAddress":"::ffff:127.0.0.1","remotePort":41658},"msg":"incoming request"}

[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.controller.spec.ts[2m 0/2[22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.controller.spec.ts[2m 0/4[22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m 0/5[22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.service.spec.ts[2m 2/2[22m

[2m Test Files [22m[1m[32m2 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m10 passed[39m[22m[90m (21)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m1.31s
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K [32m‚úì[39m src/resources/users/tests/users.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 678[2mms[22m[39m
       [33m[2m‚úì[22m[39m should be able to register a new user [33m 527[2mms[22m[39m
{"level":30,"time":1772304803636,"pid":140952,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-1","req":{"method":"POST","url":"/api/v1/sessions","host":"127.0.0.1:39413","remoteAddress":"::ffff:127.0.0.1","remotePort":54256},"msg":"incoming request"}
{"level":30,"time":1772304803637,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-1","req":{"method":"POST","url":"/api/v1/sessions","host":"127.0.0.1:46637","remoteAddress":"::ffff:127.0.0.1","remotePort":36118},"msg":"incoming request"}
{"level":30,"time":1772304803679,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-1","res":{"statusCode":200},"responseTime":41.252968998625875,"msg":"request completed"}
{"level":30,"time":1772304803682,"pid":140952,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-1","res":{"statusCode":200},"responseTime":45.10200700163841,"msg":"request completed"}
{"level":30,"time":1772304803685,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-2","req":{"method":"PATCH","url":"/api/v1/token/refresh","host":"127.0.0.1:42505","remoteAddress":"::ffff:127.0.0.1","remotePort":56360},"msg":"incoming request"}
{"level":30,"time":1772304803691,"pid":140952,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-2","req":{"method":"POST","url":"/api/v1/sessions/logout","host":"127.0.0.1:43685","remoteAddress":"::ffff:127.0.0.1","remotePort":41034},"msg":"incoming request"}
{"level":30,"time":1772304803696,"pid":140952,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-2","res":{"statusCode":204},"responseTime":4.713910000398755,"msg":"request completed"}

[1m[33m ‚ùØ [39m[22msrc/resources/auth/tests/sessions.controller.spec.ts[2m 1/2[22m
[1m[33m ‚ùØ [39m[22msrc/resources/tokens/tests/refresh.controller.spec.ts[2m 0/4[22m
[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m 0/5[22m

[2m Test Files [22m[1m[32m3 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m11 passed[39m[22m[90m (21)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m1.41s
[?2026l[?2026h[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K{"level":30,"time":1772304803702,"pid":140952,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-3","req":{"method":"POST","url":"/api/v1/sessions/logout","host":"127.0.0.1:40837","remoteAddress":"::ffff:127.0.0.1","remotePort":52938},"msg":"incoming request"}
{"level":30,"time":1772304803702,"pid":140952,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-3","res":{"statusCode":204},"responseTime":0.6141959987580776,"msg":"request completed"}
{"level":30,"time":1772304803704,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-2","res":{"statusCode":200},"responseTime":18.29117999970913,"msg":"request completed"}
 [32m‚úì[39m src/resources/auth/tests/sessions.controller.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 266[2mms[22m[39m
{"level":30,"time":1772304803720,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-3","req":{"method":"POST","url":"/api/v1/sessions","host":"127.0.0.1:44309","remoteAddress":"::ffff:127.0.0.1","remotePort":59928},"msg":"incoming request"}
{"level":30,"time":1772304803735,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-3","res":{"statusCode":200},"responseTime":15.297456000000238,"msg":"request completed"}
{"level":30,"time":1772304803737,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-4","req":{"method":"PATCH","url":"/api/v1/token/refresh","host":"127.0.0.1:34869","remoteAddress":"::ffff:127.0.0.1","remotePort":49392},"msg":"incoming request"}
{"level":30,"time":1772304803744,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-4","res":{"statusCode":200},"responseTime":7.157530000433326,"msg":"request completed"}
{"level":30,"time":1772304803747,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-5","req":{"method":"PATCH","url":"/api/v1/token/refresh","host":"127.0.0.1:46365","remoteAddress":"::ffff:127.0.0.1","remotePort":54700},"msg":"incoming request"}
{"level":30,"time":1772304803748,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-5","res":{"statusCode":401},"responseTime":0.9103449992835522,"msg":"request completed"}
{"level":30,"time":1772304803751,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-6","req":{"method":"PATCH","url":"/api/v1/token/refresh","host":"127.0.0.1:44769","remoteAddress":"::ffff:127.0.0.1","remotePort":54000},"msg":"incoming request"}
{"level":30,"time":1772304803751,"pid":140946,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-6","res":{"statusCode":401},"responseTime":0.6549100000411272,"msg":"request completed"}
{"level":30,"time":1772304803754,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-1","res":{"statusCode":201},"responseTime":233.3615930005908,"msg":"request completed"}
 [32m‚úì[39m src/resources/tokens/tests/refresh.controller.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 315[2mms[22m[39m
{"level":30,"time":1772304803761,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-2","req":{"method":"POST","url":"/api/v1/users","host":"127.0.0.1:40363","remoteAddress":"::ffff:127.0.0.1","remotePort":57340},"msg":"incoming request"}
{"level":30,"time":1772304803869,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-2","res":{"statusCode":201},"responseTime":107.51308799907565,"msg":"request completed"}
{"level":30,"time":1772304803872,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-3","req":{"method":"POST","url":"/api/v1/users","host":"127.0.0.1:42017","remoteAddress":"::ffff:127.0.0.1","remotePort":51888},"msg":"incoming request"}
{"level":30,"time":1772304803875,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-3","res":{"statusCode":409},"responseTime":3.0079709999263287,"msg":"request completed"}
{"level":30,"time":1772304803877,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-4","req":{"method":"POST","url":"/api/v1/users","host":"127.0.0.1:36583","remoteAddress":"::ffff:127.0.0.1","remotePort":53666},"msg":"incoming request"}
{"level":30,"time":1772304803878,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-4","res":{"statusCode":400},"responseTime":1.0419350005686283,"msg":"request completed"}
{"level":30,"time":1772304803880,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-5","req":{"method":"POST","url":"/api/v1/users","host":"127.0.0.1:35217","remoteAddress":"::ffff:127.0.0.1","remotePort":42000},"msg":"incoming request"}
{"level":30,"time":1772304803881,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-5","res":{"statusCode":400},"responseTime":1.150891000404954,"msg":"request completed"}
{"level":30,"time":1772304803884,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-6","req":{"method":"POST","url":"/api/v1/users","host":"127.0.0.1:41741","remoteAddress":"::ffff:127.0.0.1","remotePort":60496},"msg":"incoming request"}

[1m[33m ‚ùØ [39m[22msrc/resources/users/tests/users.controller.spec.ts[2m 2/5[22m

[2m Test Files [22m[1m[32m5 passed[39m[22m[90m (6)[39m
[2m      Tests [22m[1m[32m18 passed[39m[22m[90m (21)[39m
[2m   Start at [22m14:53:22
[2m   Duration [22m1.71s
[?2026l[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K[1A[K{"level":30,"time":1772304803990,"pid":140939,"hostname":"marcosbala070-340XAA-350XAA-550XAA","reqId":"req-6","res":{"statusCode":201},"responseTime":106.11398600041866,"msg":"request completed"}
 [32m‚úì[39m src/resources/users/tests/users.controller.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 545[2mms[22m[39m

[2m Test Files [22m [1m[32m6 passed[39m[22m[90m (6)[39m
[2m      Tests [22m [1m[32m21 passed[39m[22m[90m (21)[39m
[2m   Start at [22m 14:53:22
[2m   Duration [22m 1.81s[2m (transform 972ms, setup 0ms, import 4.00s, tests 2.42s, environment 1ms)[22m

[?25h[1G[0K‚†ô[1G[0K
